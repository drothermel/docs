---
title: dr_gen
---

<a href="https://github.com/drothermel/%24%7BREPO%7D/blob/main/src/dr_gen/analyze/database.py"><img align="right" style={{"float":"right"}} src="https://img.shields.io/badge/-source-cccccc?style=flat-square" /></a>

# <kbd>module</kbd> `analyze.database`
ExperimentDB class for unified analysis API.


## Table of Contents
- [`ExperimentDB`](./dr_gen.analyze.database#class-experimentdb)
	- [`__init__`](./dr_gen.analyze.database#constructor---init--)
	- [`active_metrics_df`](./dr_gen.analyze.database#method-active-metrics-df)
	- [`active_runs_grouped_by_hpms`](./dr_gen.analyze.database#method-active-runs-grouped-by-hpms)
	- [`format_group_description`](./dr_gen.analyze.database#method-format-group-description)
	- [`format_hparam_value`](./dr_gen.analyze.database#method-format-hparam-value)
	- [`get_display_name`](./dr_gen.analyze.database#method-get-display-name)
	- [`get_grouped_metric_dfs`](./dr_gen.analyze.database#method-get-grouped-metric-dfs)
	- [`get_groups_matching`](./dr_gen.analyze.database#method-get-groups-matching)
	- [`group_key_to_dict`](./dr_gen.analyze.database#method-group-key-to-dict)
	- [`lazy_query`](./dr_gen.analyze.database#method-lazy-query)
	- [`load_experiments`](./dr_gen.analyze.database#method-load-experiments)
	- [`query_metrics`](./dr_gen.analyze.database#method-query-metrics)
	- [`run_group_to_metric_dfs`](./dr_gen.analyze.database#method-run-group-to-metric-dfs)
	- [`stream_metrics`](./dr_gen.analyze.database#method-stream-metrics)
	- [`summarize_metrics`](./dr_gen.analyze.database#method-summarize-metrics)
	- [`update_filtered_runs`](./dr_gen.analyze.database#method-update-filtered-runs)




---

<a href="https://github.com/drothermel/%24%7BREPO%7D/blob/main/src/dr_gen/analyze/database.py#L20"><img align="right" style={{"float":"right"}} src="https://img.shields.io/badge/-source-cccccc?style=flat-square" /></a>

## <kbd>class</kbd> `ExperimentDB`
Database interface for experiment analysis with lazy loading support.


<a href="https://github.com/drothermel/%24%7BREPO%7D/blob/main/src/dr_gen/analyze/database.py#L34"><img align="right" style={{"float":"right"}} src="https://img.shields.io/badge/-source-cccccc?style=flat-square" /></a>

### <kbd>constructor</kbd> `__init__`

```python
ExperimentDB(config: AnalysisConfig, base_path=None, lazy: bool = True) → None
```





---

#### <kbd>property</kbd> active_runs_df

Get a dataframe of active runs with only the main hyperparameter columns.


---

#### <kbd>property</kbd> active_runs_hpms

Get a list of important hyperparameters for active runs.


---

#### <kbd>property</kbd> important_hpms

Get a list of important hyperparameters.


---

#### <kbd>property</kbd> model_extra

Get extra fields set during validation.


**Returns:**

    A dictionary of extra fields, or `None` if `config.extra` is not set to `"allow"`.


---

#### <kbd>property</kbd> model_fields_set

Returns the set of fields that have been explicitly set on this model instance.


**Returns:**

    A set of strings representing the fields that have been set,
        i.e. that were not filled from defaults.




---

<a href="https://github.com/drothermel/%24%7BREPO%7D/blob/main/src/dr_gen/analyze/database.py#L444"><img align="right" style={{"float":"right"}} src="https://img.shields.io/badge/-source-cccccc?style=flat-square" /></a>

### <kbd>method</kbd> `active_metrics_df`

```python
active_metrics_df() → DataFrame
```

Get a dataframe of active metrics with only the main hyperparameter columns.


---

<a href="https://github.com/drothermel/%24%7BREPO%7D/blob/main/src/dr_gen/analyze/database.py#L79"><img align="right" style={{"float":"right"}} src="https://img.shields.io/badge/-source-cccccc?style=flat-square" /></a>

### <kbd>method</kbd> `active_runs_grouped_by_hpms`

```python
active_runs_grouped_by_hpms(
    exclude_hpms: list[str] | None = None
) → tuple[list[str], dict[tuple, list[Run]]]
```

Group active runs by important hyperparameters, excluding specified hpms.

Groups runs by self.important_hpms minus excluded hpms.


**Args:**

- <b>`exclude_hpms`</b>: Hpms to exclude from grouping. If None, uses
             self.config.grouping_exclude_hpms


**Returns:**

Tuple of (grouping_keys, grouped_runs) where:
- <b>`- grouping_keys`</b>: List of hpm names used for grouping (important_hpms - exclusions)
- <b>`- grouped_runs`</b>: Dict mapping hpm value tuples to lists of runs


**Example:**

```python
    >>> # If important_hpms = ['optim.lr', 'optim.weight_decay', 'seed', 'batch_size']
>>> # And exclude_hpms = ['seed']
>>> keys, groups = db.active_runs_grouped_by_hpms()
>>> print(keys)  # ['batch_size', 'optim.lr', 'optim.weight_decay'] (sorted)
>>> print(next(iter(groups.keys())))  # (128, 0.01, 0.0001)
    ```


---

<a href="https://github.com/drothermel/%24%7BREPO%7D/blob/main/src/dr_gen/analyze/database.py#L232"><img align="right" style={{"float":"right"}} src="https://img.shields.io/badge/-source-cccccc?style=flat-square" /></a>

### <kbd>method</kbd> `format_group_description`

```python
format_group_description(
    group_key: tuple,
    hpm_names: list[str] | None = None,
    exclude_from_display: list[str] | None = None
) → str
```

Create a formatted string description of a hyperparameter group.


**Args:**

- <b>`group_key`</b>: Tuple of hyperparameter values from active_runs_grouped_by_hpms
- <b>`hpm_names`</b>: List of hyperparameter names. If None, uses the most recent
          grouping keys from active_runs_grouped_by_hpms
- <b>`exclude_from_display`</b>: Hpms to exclude from the display string. If None,
                    uses self.config.grouping_exclude_hpm_display_names


**Returns:**

Formatted string with display names and formatted values


**Example:**

```python
    >>> desc = db.format_group_description((128, 0.001, 0.0001))
>>> print(
...     desc
... )  # "Batch Size: 128, Learning Rate: 1e-03, Weight Decay: 1e-04"
    ```


---

<a href="https://github.com/drothermel/%24%7BREPO%7D/blob/main/src/dr_gen/analyze/database.py#L160"><img align="right" style={{"float":"right"}} src="https://img.shields.io/badge/-source-cccccc?style=flat-square" /></a>

### <kbd>method</kbd> `format_hparam_value`

```python
format_hparam_value(name: str, value: Any) → str
```

Format hyperparameter value for display.


**Args:**

- <b>`name`</b>: Hyperparameter name (e.g., 'optim.lr', 'optim.weight_decay')
- <b>`value`</b>: The value to format


**Returns:**

Formatted string representation


**Example:**

```python
    >>> db.format_hparam_value("optim.lr", 0.001)  # '1e-03'
>>> db.format_hparam_value("batch_size", 128)  # '128'
    ```


---

<a href="https://github.com/drothermel/%24%7BREPO%7D/blob/main/src/dr_gen/analyze/database.py#L133"><img align="right" style={{"float":"right"}} src="https://img.shields.io/badge/-source-cccccc?style=flat-square" /></a>

### <kbd>method</kbd> `get_display_name`

```python
get_display_name(name: str, name_type: str = 'auto') → str
```

Get the display name for a metric or hyperparameter.


**Args:**

- <b>`name`</b>: The technical name (e.g., 'train_loss', 'optim.lr')
- <b>`name_type`</b>: Type of name - 'metric', 'hparam', or 'auto' (default)
          'auto' will check both mappings


**Returns:**

Display name if found, otherwise returns the original name


**Example:**

```python
    >>> db.get_display_name("train_loss")  # 'Train Loss'
>>> db.get_display_name("optim.lr")  # 'Learning Rate'
>>> db.get_display_name("unknown_metric")  # 'unknown_metric'
    ```


---

<a href="https://github.com/drothermel/%24%7BREPO%7D/blob/main/src/dr_gen/analyze/database.py#L338"><img align="right" style={{"float":"right"}} src="https://img.shields.io/badge/-source-cccccc?style=flat-square" /></a>

### <kbd>method</kbd> `get_grouped_metric_dfs`

```python
get_grouped_metric_dfs(
    metrics: list[str],
    exclude_hpms: list[str] | None = None
) → dict[tuple, dict[str, DataFrame]]
```

Get metric dataframes for all hyperparameter groups.

Combines active_runs_grouped_by_hpms with run_group_to_metric_dfs.


**Args:**

- <b>`metrics`</b>: List of metric names to extract
- <b>`exclude_hpms`</b>: Hpms to exclude from grouping (see active_runs_grouped_by_hpms)


**Returns:**

Dict mapping group tuples to metric dataframes:
{
    (batch_size, arch, lr, wd): {
- <b>`'train_loss'`</b>: DataFrame,
- <b>`'val_acc'`</b>: DataFrame,
...
},
...
}


**Example:**

```python
    >>> grouped_dfs = db.get_grouped_metric_dfs(["train_loss", "val_acc"])
>>> for group_key, metric_dfs in grouped_dfs.items():
>>>     print(f"Group {group_key}:")
>>>     print(f"  Train loss shape: {metric_dfs['train_loss'].shape}")
    ```


---

<a href="https://github.com/drothermel/%24%7BREPO%7D/blob/main/src/dr_gen/analyze/database.py#L374"><img align="right" style={{"float":"right"}} src="https://img.shields.io/badge/-source-cccccc?style=flat-square" /></a>

### <kbd>method</kbd> `get_groups_matching`

```python
get_groups_matching(
    base_hpms: dict[str, Any],
    varying_hpms: list[str] | None = None,
    metrics: list[str] | None = None
) → tuple[list[str], dict[tuple, Any]]
```

Get run groups that match specific base hyperparameters.

Useful for getting all (lr, wd) combinations for a specific model/batch_size.


**Args:**

- <b>`base_hpms`</b>: Dict of hyperparameters that must match exactly
- <b>`varying_hpms`</b>: List of hyperparameters that are allowed to vary.
             If None, uses ['optim.lr', 'optim.weight_decay']
- <b>`metrics`</b>: If provided, returns metric DataFrames instead of Run lists


**Returns:**

Tuple of (hpm_names, groups) where:
- <b>`- hpm_names`</b>: List of hyperparameter names in the group keys (varying_hpms)
- <b>`- groups`</b>: Dict mapping tuples to either Run lists or metric DataFrames


**Example:**

```python
    >>> # Get all lr/wd combinations for a specific architecture
>>> hpm_names, groups = db.get_groups_matching(
...     {"model.architecture": "resnet18", "batch_size": 128},
...     varying_hpms=["optim.lr", "optim.weight_decay"],
... )
>>> # groups keys will be (lr, wd) tuples
    ```


---

<a href="https://github.com/drothermel/%24%7BREPO%7D/blob/main/src/dr_gen/analyze/database.py#L186"><img align="right" style={{"float":"right"}} src="https://img.shields.io/badge/-source-cccccc?style=flat-square" /></a>

### <kbd>method</kbd> `group_key_to_dict`

```python
group_key_to_dict(
    group_key: tuple,
    hpm_names: list[str] | None = None,
    use_display_names: bool = False
) → dict[str, Any]
```

Convert a group key tuple to a hyperparameter dictionary.


**Args:**

- <b>`group_key`</b>: Tuple of hyperparameter values from active_runs_grouped_by_hpms
- <b>`hpm_names`</b>: List of hyperparameter names. If None, uses the most recent
          grouping keys from active_runs_grouped_by_hpms
- <b>`use_display_names`</b>: If True, use display names as dict keys


**Returns:**

Dict mapping hyperparameter names (or display names) to values


**Example:**

```python
    >>> hpm_names, run_groups = db.active_runs_grouped_by_hpms()
>>> for group_key, runs in run_groups.items():
>>> # Technical names
>>>     hpm_dict = db.group_key_to_dict(group_key, hpm_names)
>>>     print(f"LR: {hpm_dict['optim.lr']}, WD: {hpm_dict['optim.weight_decay']}")
>>> # Display names
>>>     display_dict = db.group_key_to_dict(group_key, hpm_names, use_display_names=True)
>>>     print(f"{display_dict['Learning Rate']}, {display_dict['Weight Decay']}")
    ```


---

<a href="https://github.com/drothermel/%24%7BREPO%7D/blob/main/src/dr_gen/analyze/database.py#L466"><img align="right" style={{"float":"right"}} src="https://img.shields.io/badge/-source-cccccc?style=flat-square" /></a>

### <kbd>method</kbd> `lazy_query`

```python
lazy_query() → LazyFrame
```

Get a lazy frame for efficient querying of large datasets.


---

<a href="https://github.com/drothermel/%24%7BREPO%7D/blob/main/src/dr_gen/analyze/database.py#L42"><img align="right" style={{"float":"right"}} src="https://img.shields.io/badge/-source-cccccc?style=flat-square" /></a>

### <kbd>method</kbd> `load_experiments`

```python
load_experiments() → None
```

Load experiments from base_path directory.


---

<a href="https://github.com/drothermel/%24%7BREPO%7D/blob/main/src/dr_gen/analyze/database.py#L450"><img align="right" style={{"float":"right"}} src="https://img.shields.io/badge/-source-cccccc?style=flat-square" /></a>

### <kbd>method</kbd> `query_metrics`

```python
query_metrics(
    metric_filter: str | None = None,
    run_filter: list[str] | None = None
) → DataFrame
```

Query metrics with optional filters.


---

<a href="https://github.com/drothermel/%24%7BREPO%7D/blob/main/src/dr_gen/analyze/database.py#L274"><img align="right" style={{"float":"right"}} src="https://img.shields.io/badge/-source-cccccc?style=flat-square" /></a>

### <kbd>method</kbd> `run_group_to_metric_dfs`

```python
run_group_to_metric_dfs(
    run_group: list[Run],
    metrics: list[str]
) → dict[str, DataFrame]
```

Convert a group of runs to metric dataframes with one column per run.

Assumes all runs in a group have the same length for each metric.
The DataFrame index is just integers (0, 1, 2, ...) - you can use any
metric (epoch, step, cumulative_lr, etc.) as your x-axis separately.


**Args:**

- <b>`run_group`</b>: List of Run objects (e.g., from active_runs_grouped_by_hpms)
- <b>`metrics`</b>: List of metric names to extract


**Returns:**

Dict mapping metric_name to DataFrame where:
- <b>`- Index`</b>: integers from 0 to length-1
- <b>`- Columns`</b>: seed_N or run_id (one column per run)
- <b>`- Values`</b>: metric values


**Example:**

```python
    >>> group_key, runs = next(
...     iter(db.active_runs_grouped_by_hpms()[1].items())
... )
>>> dfs = db.run_group_to_metric_dfs(
...     runs, ["train_loss", "val_acc", "epoch"]
... )
>>> print(dfs["train_loss"].head())
     seed_0    seed_1    seed_2
0    2.301     2.298     2.305
1    1.845     1.850     1.843
2    1.523     1.531     1.519

>>> # Use any metric as x-axis
>>> epochs = dfs["epoch"].iloc[:, 0]  # Get epoch values from first run
>>> plt.plot(epochs, dfs["train_loss"].mean(axis=1))
    ```


---

<a href="https://github.com/drothermel/%24%7BREPO%7D/blob/main/src/dr_gen/analyze/database.py#L474"><img align="right" style={{"float":"right"}} src="https://img.shields.io/badge/-source-cccccc?style=flat-square" /></a>

### <kbd>method</kbd> `stream_metrics`

```python
stream_metrics() → DataFrame
```

Stream metrics for memory-efficient processing of large datasets.


---

<a href="https://github.com/drothermel/%24%7BREPO%7D/blob/main/src/dr_gen/analyze/database.py#L458"><img align="right" style={{"float":"right"}} src="https://img.shields.io/badge/-source-cccccc?style=flat-square" /></a>

### <kbd>method</kbd> `summarize_metrics`

```python
summarize_metrics(hparams: list[str]) → DataFrame
```

Get summary statistics grouped by hyperparameters.


---

<a href="https://github.com/drothermel/%24%7BREPO%7D/blob/main/src/dr_gen/analyze/database.py#L48"><img align="right" style={{"float":"right"}} src="https://img.shields.io/badge/-source-cccccc?style=flat-square" /></a>

### <kbd>method</kbd> `update_filtered_runs`

```python
update_filtered_runs() → None
```

Filter runs based on the filter_out_runs configuration.





---

_This file was automatically generated via [lazydocs](https://github.com/ml-tooling/lazydocs)._
